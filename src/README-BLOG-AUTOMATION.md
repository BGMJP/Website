# 아마존캐리 RSS 블로그 연동 시스템 (전체 글 지원)

## 개요

네이버 블로그 `amz_carry`의 RSS 피드에서 최신 포스트 3개를 실시간으로 가져와서 **전체 글 내용**을 포함하여 웹사이트에 자동으로 표시하는 고급 시스템입니다.

## 🚀 새로운 핵심 기능

### 📖 전체 글 내용 표시
- **스마트 컨텐츠 추출**: RSS의 `content:encoded` 필드 우선 활용
- **웹 페이지 스크래핑**: RSS에 전체 내용이 없을 경우 실제 블로그 페이지에서 스크래핑
- **완전한 읽기 경험**: 요약이 아닌 전체 블로그 글을 모달에서 제공
- **컨텐츠 품질 표시**: 전체글/요약 여부를 사용자에게 명확히 안내

### 🎯 다중 컨텐츠 소스 지원
1. **content:encoded** (RSS 전체 내용) - 최우선
2. **웹 스크래핑** (실제 블로그 페이지) - 차선책
3. **description** (RSS 요약) - 기본값
4. **fallback** (정적 샘플) - 에러 시

### 🎨 향상된 UI/UX
- **컨텐츠 품질 배지**: "전체 글 내용" vs "요약 내용" 구분 표시
- **개선된 모달**: 더 큰 화면, 스크롤 최적화, 읽기 전용 디자인
- **스타일링**: 블로그 글에 최적화된 타이포그래피 및 이미지 처리
- **반응형**: 모든 기기에서 완벽한 읽기 경험

## 📋 기술 구조

### 백엔드 (Supabase Edge Function)

#### RSS 파싱 엔진
```typescript
async function parseRSS(url: string) {
  // 1. RSS XML 파싱
  // 2. content:encoded 필드 확인
  // 3. 웹 스크래핑 시도 (필요시)
  // 4. 컨텐츠 정리 및 포맷팅
}
```

#### 웹 스크래핑 시스템
```typescript
async function scrapeBlogContent(url: string) {
  // 1. 네이버 블로그 페이지 요청
  // 2. 본문 영역 추출 (다중 패턴 매칭)
  // 3. HTML 정리 (불필요한 요소 제거)
  // 4. 이미지 경로 정규화
}
```

#### 컨텐츠 처리 파이프라인
1. **RSS 파싱**: 기본 메타데이터 추출
2. **content:encoded 확인**: 전체 내용 있는지 검사
3. **웹 스크래핑**: content:encoded 없으면 실제 페이지 스크래핑
4. **HTML 정리**: 불필요한 태그, 스타일, 스크립트 제거
5. **이미지 최적화**: 상대 경로를 절대 경로로 변환
6. **메타데이터 생성**: 읽기 시간, 카테고리별 이미지 등

### 프론트엔드 (React + TypeScript)

#### 상태 관리
```typescript
interface BlogPost {
  id: string;
  category: string;
  title: string;
  excerpt: string;        // 카드용 요약
  htmlContent: string;    // 모달용 전체 내용
  contentSource: string;  // 컨텐츠 출처 ('scraped', 'content:encoded', 'description')
  // ... 기타 메타데이터
}
```

#### 컨텐츠 품질 표시
- **🟢 전체 글 내용**: 스크래핑 또는 content:encoded로 가져온 완전한 글
- **🔵 RSS 전체 내용**: RSS에서 제공한 전체 내용
- **🟡 요약 내용**: RSS description만 사용 (제한적)

## 🔧 스크래핑 기술 세부사항

### 네이버 블로그 패턴 매칭
```typescript
const patterns = [
  // 네이버 블로그 본문 영역
  /<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>(.*?)<\/div>/gs,
  /<div[^>]*class="[^"]*post-view[^"]*"[^>]*>(.*?)<\/div>/gs,
  /<div[^>]*class="[^"]*entry-content[^"]*"[^>]*>(.*?)<\/div>/gs,
  // 일반적인 본문 패턴
  /<div[^>]*id="[^"]*content[^"]*"[^>]*>(.*?)<\/div>/gs,
  /<article[^>]*>(.*?)<\/article>/gs,
  /<main[^>]*>(.*?)<\/main>/gs
];
```

### HTML 정리 프로세스
1. **스크립트/스타일 제거**: `<script>`, `<style>` 태그 완전 제거
2. **네이버 특정 요소 제거**: 댓글, 네비게이션, 사이드바, 광고 영역
3. **속성 정리**: `onclick`, `style`, `class` 등 불필요한 속성 제거
4. **이미지 경로 정규화**: 상대 경로를 절대 경로로 변환

## 🎨 모달 디자인 시스템

### 타이포그래피
- **제목**: 3xl-4xl, font-black, 줄높이 1.2
- **본문**: 1.8 줄높이, #374151 색상
- **헤딩**: 계층적 크기 (h1: 1.875rem ~ h4: 1.125rem)

### 이미지 처리
- **자동 크기 조정**: max-width: 100%, 반응형
- **둥근 모서리**: 12px border-radius
- **그림자**: 미묘한 box-shadow로 입체감
- **중앙 정렬**: display: block, margin: auto

### 코드 및 인용구
- **코드 블록**: 다크 테마 (#1F2937 배경)
- **인라인 코드**: 회색 배경 (#F3F4F6)
- **인용구**: 보라색 좌측 경계선, 회색 배경

## 📊 성능 최적화

### 캐싱 전략
- **메모리 캐시**: 30분 유효 기간
- **조건부 스크래핑**: content:encoded 있으면 스크래핑 생략
- **병렬 처리**: 3개 포스트 동시 처리

### 에러 복구
- **다단계 Fallback**: 스크래핑 실패 → description 사용 → 정적 컨텐츠
- **상태 피드백**: 각 컨텐츠 소스별 명확한 상태 표시
- **재시도 기능**: 사용자 수동 새로고침 지원

## 🔍 로깅 및 디버깅

### 서버 로깅
```typescript
console.log(`Processing post ${index + 1}: ${title}`);
console.log(`Description length: ${description.length}`);
console.log(`Content:encoded length: ${contentEncoded.length}`);
console.log(`Successfully scraped content, length: ${scrapedContent.length}`);
```

### 클라이언트 상태
- **컨텐츠 소스 표시**: 각 포스트의 데이터 출처 확인 가능
- **마지막 업데이트**: 데이터 신선도 확인
- **에러 메시지**: 구체적인 문제 상황 안내

## 🚀 사용자 경험

### 카드 인터페이스
- **품질 배지**: 우상단에 "전체글" 또는 "요약" 표시
- **호버 효과**: 3D 변형 및 그림자 증가
- **명확한 CTA**: "전체 글 읽기" 버튼

### 모달 읽기 경험
- **대형 화면**: 최대 4xl 너비, 90vh 높이
- **부드러운 스크롤**: 스크롤바 숨김, 최적화된 스크롤링
- **키보드 지원**: ESC 키로 닫기
- **원본 링크**: 네이버 블로그 원본으로 바로 이동

## 📱 반응형 지원

- **모바일**: 전체 화면 모달, 터치 최적화
- **태블릿**: 적당한 여백과 패딩
- **데스크톱**: 대화형 읽기 경험

## 🔮 향후 계획

- [ ] **이미지 최적화**: WebP 변환, 지연 로딩
- [ ] **검색 기능**: 포스트 내 키워드 검색
- [ ] **북마크**: 즐겨찾는 글 저장
- [ ] **소셜 공유**: 카카오톡, 페이스북 등 공유
- [ ] **오프라인 읽기**: PWA 캐싱
- [ ] **다크 모드**: 읽기 모드 테마 지원

## ⚠️ 주의사항

- **네이버 정책**: 과도한 스크래핑 방지를 위한 캐싱 시스템
- **CORS 제한**: 서버를 통한 우회 접근 필요
- **동적 컨텐츠**: JavaScript 렌더링 콘텐츠는 제한적 지원
- **HTML 구조 변경**: 네이버 블로그 구조 변경 시 패턴 업데이트 필요

이제 사용자들이 RSS 카드에서 "전체 글 읽기"를 클릭하면 완전한 블로그 포스트를 읽을 수 있습니다! 🎉📚